---
import company from "@/data/company.json";

// nÃºmero limpio sin '+'
const whatsappNumber = company.whatsapp.replace("+", "");
---

<!-- BotÃ³n flotante global de WhatsApp -->
<div
  id="whatsapp-container"
  class="fixed bottom-5 right-5 z-[9999] flex flex-col items-end gap-2"
>
  <!-- Burbuja opcional -->
  <div
    id="whatsapp-bubble"
    class="hidden md:flex items-center bg-white text-[rgb(8,62,82)] text-sm font-medium shadow-lg rounded-xl px-4 py-2 transition-all duration-500 opacity-0 translate-y-2"
  >
    Â¿Necesitas ayuda? <span class="ml-2 text-[rgb(11,122,163)] font-semibold">EscrÃ­benos ğŸ’¬</span>
  </div>

  <!-- BotÃ³n principal -->
  <a
    href={`https://wa.me/${whatsappNumber}`}
    target="_blank"
    rel="noopener noreferrer"
    aria-label="WhatsApp"
    class="group flex items-center justify-center w-14 h-14 rounded-full bg-[#25D366] text-white shadow-xl hover:scale-110 transition-transform duration-300"
  >
    <img src="/whatsapp.svg" alt="WhatsApp" class="w-7 h-7" />
  </a>
</div>

<!-- Script: muestra la burbuja despuÃ©s de unos segundos -->
<script is:inline>
  const bubble = document.getElementById("whatsapp-bubble");

  if (bubble) {
    // Mostrar despuÃ©s de 3 segundos, una vez por sesiÃ³n
    const shown = sessionStorage.getItem("whatsapp-bubble-shown");
    if (!shown) {
      setTimeout(() => {
        bubble.classList.remove("hidden");
        requestAnimationFrame(() => {
          bubble.classList.add("opacity-100", "translate-y-0");
        });
        sessionStorage.setItem("whatsapp-bubble-shown", "true");
      }, 3000);
    }

    // Ocultar al pasar el mouse
    bubble.addEventListener("mouseenter", () => {
      bubble.classList.remove("opacity-100");
      bubble.classList.add("opacity-0");
      setTimeout(() => bubble.classList.add("hidden"), 500);
    });
  }
</script>
